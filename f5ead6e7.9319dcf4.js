(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{274:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return s}));var a=n(2),i=n(9),r=(n(0),n(282)),o={id:"structure-API",title:"Structure API",sidebar_label:"Structure API"},c={id:"editor-flow/structure-API",title:"Structure API",description:"## Basic app structure",source:"@site/docs/editor-flow/structure-API.md",permalink:"/yoshi/docs/next/editor-flow/structure-API",editUrl:"https://github.com/wix/yoshi/edit/master/website/docs/editor-flow/structure-API.md",version:"next",lastUpdatedBy:"Artem Yavorsky",lastUpdatedAt:1589837758,sidebar_label:"Structure API",sidebar:"editor-flow",previous:{title:"CLI API",permalink:"/yoshi/docs/next/editor-flow/cli-API"},next:{title:"Runtime API",permalink:"/yoshi/docs/next/editor-flow/runtime-API"}},l=[{value:"Basic app structure",id:"basic-app-structure",children:[]},{value:"<code>.application.json</code>",id:"applicationjson",children:[]},{value:"Application level",id:"application-level",children:[{value:"<code>viewer.app.ts</code>",id:"viewerappts",children:[]},{value:"<code>editor.app.ts</code>",id:"editorappts",children:[]}]},{value:"Component level",id:"component-level",children:[{value:"<code>.component.json</code>",id:"componentjson",children:[]},{value:"<code>controller</code>",id:"controller",children:[]},{value:"<code>Widget</code>",id:"widget",children:[]},{value:"<code>Settings</code>",id:"settings",children:[]}]}],p={rightToc:l};function s(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"basic-app-structure"},"Basic app structure"),Object(r.b)("p",null,"After you bootstraped the app via create-yoshi-app, the structure will be similar to:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"my-app\n\u251c\u2500\u2500 .application.json\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 viewer.app.ts\n    \u251c\u2500\u2500 editor.app.ts\n    \u251c\u2500\u2500 assets\n    \u2502   \u2514\u2500\u2500 locales\n    \u2514\u2500\u2500 components\n        \u2514\u2500\u2500 MyComponent\n            \u251c\u2500\u2500 .component.json\n            \u251c\u2500\u2500 controller.ts\n            \u251c\u2500\u2500 controller.spec.ts\n            \u251c\u2500\u2500 Widget\n            \u2502   \u251c\u2500\u2500 index.ts\n            \u2502   \u251c\u2500\u2500 Widget.tsx\n            \u2502   \u251c\u2500\u2500 Widget.spec.ts\n            \u2502   \u251c\u2500\u2500 Widget.e2e.ts\n            \u2502   \u2514\u2500\u2500 Widget.st.css\n            \u2514\u2500\u2500 Settings\n                \u251c\u2500\u2500 index.ts\n                \u251c\u2500\u2500 Settings.tsx\n                \u251c\u2500\u2500 Settings.spec.ts\n                \u251c\u2500\u2500 Settings.e2e.ts\n                \u2514\u2500\u2500 Settings.scss\n")),Object(r.b)("h2",{id:"applicationjson"},Object(r.b)("inlineCode",{parentName:"h2"},".application.json")),Object(r.b)("p",null,"Each app should contain ",Object(r.b)("inlineCode",{parentName:"p"},".application.json"),". It's content will be auto-generated by ",Object(r.b)("inlineCode",{parentName:"p"},"create-yoshi-app"),".\nIt will be:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"{\n  appDefinitionId: 'YOUR_APP_DEFINITION_ID'\n}\n")),Object(r.b)("p",null,"To use app configration values in runtime it's valid to:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"import { appDefinitionId } from '../../.application.json';\n")),Object(r.b)("h2",{id:"application-level"},"Application level"),Object(r.b)("p",null,"Under ",Object(r.b)("inlineCode",{parentName:"p"},"src")," directory located: ",Object(r.b)("inlineCode",{parentName:"p"},"viewer.app.ts"),", ",Object(r.b)("inlineCode",{parentName:"p"},"editor.app.ts"),", ",Object(r.b)("inlineCode",{parentName:"p"},"assets")," and ",Object(r.b)("inlineCode",{parentName:"p"},"components"),"."),Object(r.b)("h3",{id:"viewerappts"},Object(r.b)("inlineCode",{parentName:"h3"},"viewer.app.ts")),Object(r.b)("p",null,"Entry point for Viewer Script file."),Object(r.b)("h4",{id:"initappforpage"},Object(r.b)("inlineCode",{parentName:"h4"},"initAppForPage")),Object(r.b)("p",null,"A general call to the service where it should initiate its reusable data across components.\nIt's called with the basic configuration of the application before the Viewer knows which components exist on the page."),Object(r.b)("p",null,"\u26a0\ufe0f You shouldn't use ",Object(r.b)("inlineCode",{parentName:"p"},"createControllers"),". We will generate it under the hood."),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"src/viewer.app.ts")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"export const initAppForPage = (initParams, platformApis, wixCodeApi, platformServicesApis) => {\n  fetchExperiments();\n  initStorage();\n};\n")),Object(r.b)("p",null,"For more info related to ",Object(r.b)("inlineCode",{parentName:"p"},"initAppForPage")," check the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://bo.wix.com/wix-docs/client/client-viewer-platform/articles/lifecycle#client-viewer-platform_articles_lifecycle_initappforpage"}),"Viewer platform official docs")),Object(r.b)("h3",{id:"editorappts"},Object(r.b)("inlineCode",{parentName:"h3"},"editor.app.ts")),Object(r.b)("p",null,"Entry point for Editor Script file."),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"src/editor.app.ts")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"export const editorReady = async (editorSDK, appDefinitionId, { origin, firstInstall }) => {\n  const platform = new AppPlatform(editorSDK, appDefinitionId);\n\n  if (firstInstall) {\n    await platform.install();\n  } else {\n    await platform.hackForTemplates();\n  }\n};\n\nexport const getAppManifest = async () => {\n  return getManifest();\n};\n")),Object(r.b)("p",null,"For more info about editor platform script, please check ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://bo.wix.com/wix-docs/client/editor-platform/editor-application-reference/editor-platform-app"}),"Editor Platform offical docs")),Object(r.b)("h2",{id:"component-level"},"Component level"),Object(r.b)("p",null,"According to the Yoshi Editor Flow concept, the app is grouped by components, instead of functional purpose. Since communitcation between different components (Widget, Page) in scope of single app is a rare case, people usually working on single Component while working on the new business feature."),Object(r.b)("p",null,"So for now, we'll have ",Object(r.b)("inlineCode",{parentName:"p"},"Widget"),", ",Object(r.b)("inlineCode",{parentName:"p"},"Settings")," and ",Object(r.b)("inlineCode",{parentName:"p"},"controller")," in a single place, instead of having ",Object(r.b)("inlineCode",{parentName:"p"},"settings")," directory with all settings panels of your app. Or ",Object(r.b)("inlineCode",{parentName:"p"},"viewerScript")," directory, which will include all controllers. With last approach, it could be really hard to navigate between ",Object(r.b)("inlineCode",{parentName:"p"},"controller")," and ",Object(r.b)("inlineCode",{parentName:"p"},"Widget")," located in completely different directories or even projects, since Widget consumes properties passed by controller. You'll probably want to maintain ",Object(r.b)("inlineCode",{parentName:"p"},"PublicData")," in a single place also instead of switching between settings and widget directory."),Object(r.b)("h3",{id:"componentjson"},Object(r.b)("inlineCode",{parentName:"h3"},".component.json")),Object(r.b)("p",null,"Located under ",Object(r.b)("inlineCode",{parentName:"p"},"src/components/:componentName/.component.json")," this config file helps us to generate ",Object(r.b)("inlineCode",{parentName:"p"},"createControllers")," for Viewer Script under the hood. Here you can find ",Object(r.b)("inlineCode",{parentName:"p"},"id")," of your component and type (",Object(r.b)("inlineCode",{parentName:"p"},"WIDGET_OUT_OF_IFRAME"),", ",Object(r.b)("inlineCode",{parentName:"p"},"PAGE_OUT)OF_IFRAME")," or ",Object(r.b)("inlineCode",{parentName:"p"},"APP_STUDIO_WIDGET"),")."),Object(r.b)("h3",{id:"controller"},Object(r.b)("inlineCode",{parentName:"h3"},"controller")),Object(r.b)("p",null,"File which ",Object(r.b)("inlineCode",{parentName:"p"},"export default createController")," function."),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"createController")," is called with useful arguments by platform."),Object(r.b)("p",null,"Arguments:"),Object(r.b)("h4",{id:"controllerconfig-platform-icontrollerinfo"},Object(r.b)("inlineCode",{parentName:"h4"},"controllerConfig:")," ",Object(r.b)("em",{parentName:"h4"},"(platform)")," ",Object(r.b)("a",Object(a.a)({parentName:"h4"},{href:"https://bo.wix.com/wix-docs/client/client-viewer-platform/articles/lifecycle#client-viewer-platform_articles_lifecycle_controllerinfo"}),"IControllerInfo")),Object(r.b)("h5",{id:"appdata-flow"},Object(r.b)("inlineCode",{parentName:"h5"},"appData"),": ",Object(r.b)("em",{parentName:"h5"},"(flow)")),Object(r.b)("p",null,"Object which aims to use data for all controllers. This is a data that comes from ",Object(r.b)("inlineCode",{parentName:"p"},"mapPlatformStateToAppData")," method, which is being called before ",Object(r.b)("inlineCode",{parentName:"p"},"createControllers"),"."),Object(r.b)("h4",{id:"flowdata-flow"},Object(r.b)("inlineCode",{parentName:"h4"},"flowData"),": ",Object(r.b)("em",{parentName:"h4"},"(flow)")),Object(r.b)("p",null,"Data with experiments, locations and other info being fetched."),Object(r.b)("h5",{id:"getexperiments-promiseexperiments"},Object(r.b)("inlineCode",{parentName:"h5"},"getExperiments"),": ",Object(r.b)("inlineCode",{parentName:"h5"},"Promise<Experiments>")),Object(r.b)("p",null,"Return a Promise, which will be resolved with ",Object(r.b)("inlineCode",{parentName:"p"},"Experiments")," instance for current scope.\nTakes a configuration from ",Object(r.b)("inlineCode",{parentName:"p"},"experiments")," field in ",Object(r.b)("inlineCode",{parentName:"p"},".application.json"),"."),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"Simple example"),"\n",Object(r.b)("em",{parentName:"p"},"controller.ts")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"export default async function createController({ flowData }) => {\n  return {\n    pageReady() {\n      const experiments = await flowData.getExperiments();\n      setProps({\n        withNewButton: experiments.enabled('specs.my-scope.EnableNewButton'),\n      });\n    }\n  };\n}\n")),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"Parallel loading example"),"\n",Object(r.b)("em",{parentName:"p"},"controller.ts")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"export default async function createController({ flowData }) => {\n  return {\n    pageReady() {\n      const [experiments, someData] = await Promise.all([\n        flowData.getExperiments(),\n        getSomeData(),\n      ]);\n      setProps({\n        withNewButton: experiments.enabled('specs.my-scope.EnableNewButton'),\n        someData,\n      });\n    }\n  };\n}\n")),Object(r.b)("h3",{id:"widget"},Object(r.b)("inlineCode",{parentName:"h3"},"Widget")),Object(r.b)("p",null,"File which ",Object(r.b)("inlineCode",{parentName:"p"},"export default")," React Component."),Object(r.b)("p",null,"This component will be rendered in 2 different environments: viewer (common frame for the whole side) and editor (isolated iFrame).\nThe basic idea is that developers shouldn't be aware of this difference.\nJust exporting a valid React Component and receiving a props from the controller's ",Object(r.b)("inlineCode",{parentName:"p"},"setProps")," will perfectly work."),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"Widget.ts")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"export default ({ title }) => (<div>\n  <h1>{title}</h1>\n</div>)\n")),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"controller.ts")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"export default () => ({\n  pageReady() {\n    setProps({\n      title: 'Some title from controller',\n    });\n  }\n})\n")),Object(r.b)("h3",{id:"settings"},Object(r.b)("inlineCode",{parentName:"h3"},"Settings")),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"(optional)")),Object(r.b)("p",null,"File which ",Object(r.b)("inlineCode",{parentName:"p"},"export default")," React Component."),Object(r.b)("p",null,"It will be rendered in editor part. Via Settings panel app's user can configure Out-of-iFrame Widget."),Object(r.b)("p",null,"It's recommend to use ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/wix-private/wix-base-ui"}),Object(r.b)("inlineCode",{parentName:"a"},"wix-base-ui"))," for styling and ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/wix-private/tpa-settings"}),"TPA Settings")," for reducing boilerplate relating to Settings panel development."),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"Settings")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"import { TpaSettingsProvider } from '@wix/tpa-settings/dist/src/contexts';\nimport { SettingsTabLayout } from '@wix/tpa-settings/dist/src/components';\nimport { WixSDK } from 'yoshi-flow-editor-runtime';\nimport 'yoshi-flow-editor-runtime/styles/wix-base-ui.global.scss';\n\nconst Settings = () => {\n  return (\n    <WixSDK>{({ Wix }) => (\n      <TpaSettingsProvider Wix={Wix}>\n        <SettingsTabLayout>\n          <SettingsTabLayout.Tab\n            title={t('settings.tab.main')}\n            articleId=\"78c122c7-ef06-47c1-a137-07abfae7ed89\"\n            Component={() => <MainTab />}\n          />\n        </SettingsTabLayout>\n      </TpaSettingsProvider>\n    )}</WixSDK>\n  );\n};\n\nexport default Settings;\n")))}s.isMDXComponent=!0},282:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return u}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=i.a.createContext({}),s=function(e){var t=i.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):c({},t,{},e)),n},b=function(e){var t=s(e.components);return i.a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},m=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),b=s(n),m=a,u=b["".concat(o,".").concat(m)]||b[m]||d[m]||r;return n?i.a.createElement(u,c({ref:t},p,{components:n})):i.a.createElement(u,c({ref:t},p))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var p=2;p<r;p++)o[p]=n[p];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);