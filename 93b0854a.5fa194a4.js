(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{191:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return l})),t.d(n,"rightToc",(function(){return s})),t.d(n,"default",(function(){return b}));var o=t(2),a=t(6),r=(t(0),t(259)),i={id:"migration",title:"Migration Guide",sidebar_label:"Migration Guide"},l={id:"version-4.x/business-manager-flow/migration",title:"Migration Guide",description:"This guide will help you migrate your existing Business-Manager applications written using Legacy or App Flows, to the new Business-Manager Flow! \ud83e\udd1d",source:"@site/versioned_docs/version-4.x/business-manager-flow/migration.md",permalink:"/yoshi/docs/business-manager-flow/migration",editUrl:"https://github.com/wix/yoshi/edit/master/website/versioned_docs/version-4.x/business-manager-flow/migration.md",version:"4.x",lastUpdatedBy:"Ran Yitzhaki",lastUpdatedAt:1593692023,sidebar_label:"Migration Guide",sidebar:"version-4.x/business-manager-flow",previous:{title:"Business-Manager Flow Overview",permalink:"/yoshi/docs/business-manager-flow/overview"}},s=[{value:"Getting Started",id:"getting-started",children:[{value:"Installation",id:"installation",children:[]},{value:"Configuration",id:"configuration",children:[]},{value:"BusinessManagerModule bundle",id:"businessmanagermodule-bundle",children:[]},{value:"Page Components",id:"page-components",children:[]},{value:"Exported Components",id:"exported-components",children:[]},{value:"Methods",id:"methods",children:[]}]},{value:"Multiple GAables",id:"multiple-gaables",children:[]},{value:"Feedback",id:"feedback",children:[]}],c={rightToc:s};function b(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},c,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"This guide will help you migrate your existing Business-Manager applications written using Legacy or App Flows, to the new Business-Manager Flow! \ud83e\udd1d"),Object(r.b)("h2",{id:"getting-started"},"Getting Started"),Object(r.b)("p",null,"Start with a clean git tree, preferably in a branch working towards a migration PR with nothing but the migration."),Object(r.b)("h3",{id:"installation"},"Installation"),Object(r.b)("p",null,"Remove all ",Object(r.b)("inlineCode",{parentName:"p"},"node_modules")," and lock files to ensure everything would be installed as expected."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"rm -rf node_modules package-lock.json yarn.lock\n")),Object(r.b)("p",null,"Replace ",Object(r.b)("inlineCode",{parentName:"p"},"yoshi")," with ",Object(r.b)("inlineCode",{parentName:"p"},"yoshi-flow-bm")," (in ",Object(r.b)("inlineCode",{parentName:"p"},"devDependencies"),") & add ",Object(r.b)("inlineCode",{parentName:"p"},"yoshi-flow-bm-runtime")," (in ",Object(r.b)("inlineCode",{parentName:"p"},"dependencies"),"):"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-diff",metastring:"json",json:!0}),'{\n  "devDependencies": {\n-   "yoshi": "^4.0.0"\n+   "yoshi-flow-bm": "^4.0.0"\n  },\n  "dependencies": {\n+   "yoshi-flow-bm-runtime": "^4.0.0"\n  }\n}\n')),Object(r.b)("p",null,"Followed by running ",Object(r.b)("inlineCode",{parentName:"p"},"npm install"),"."),Object(r.b)("p",null,"Then, replace ",Object(r.b)("inlineCode",{parentName:"p"},"yoshi")," cli usages with ",Object(r.b)("inlineCode",{parentName:"p"},"yoshi-bm"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-diff",metastring:"json",json:!0}),'{\n  "scripts": {\n-   "start": "yoshi start",\n-   "build": "yoshi build",\n-   "test": "yoshi test",\n-   "lint": "yoshi lint",\n-   "posttest": "npm run lint"\n+   "start": "yoshi-bm start",\n+   "build": "yoshi-bm build",\n+   "test": "yoshi-bm test",\n+   "lint": "yoshi-bm lint",\n+   "posttest": "npm run lint"\n  }\n}\n')),Object(r.b)("p",null,"Use ",Object(r.b)("inlineCode",{parentName:"p"},"yoshi-flow-bm")," types instead of yoshi's:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"tsconfig.json"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-diff",metastring:"json",json:!0}),'{\n  "files": [\n-   "./node_modules/yoshi/types.d.ts"\n+   "./node_modules/yoshi-flow-bm/types.d.ts"\n  ]\n}\n')),Object(r.b)("h3",{id:"configuration"},"Configuration"),Object(r.b)("p",null,"The BM Flow tries to minimize configuration whenever possible simply by being aware of the BM platform, along with using filesystem conventions over configuration (as seen further in this guide)."),Object(r.b)("p",null,"Remove your ",Object(r.b)("inlineCode",{parentName:"p"},"yoshi.config.js")," file or the ",Object(r.b)("inlineCode",{parentName:"p"},"yoshi")," configuration section in your ",Object(r.b)("inlineCode",{parentName:"p"},"package.json"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-diff",metastring:"json",json:!0}),'{\n- "yoshi": {\n-   "projectType": "app",\n-   "yoshiServer": true,\n-   "entry": {\n-     "module": "./module",\n-     "...": "..."\n-   },\n-   "externals": {\n-     "react": "React",\n-     "react-dom": "ReactDOM",\n-     "react-addons-css-transition-group": "React.addons.CSSTransitionGroup",\n-     "lodash": "_",\n-     "urijs": "URI",\n-     "@wix/business-manager-api": "BusinessManagerAPI",\n-     "react-module-container": "reactModuleContainer"\n-   }\n- }\n}\n')),Object(r.b)("h3",{id:"businessmanagermodule-bundle"},Object(r.b)("a",Object(o.a)({parentName:"h3"},{href:"overview#module-bundle"}),Object(r.b)("inlineCode",{parentName:"a"},"BusinessManagerModule")," bundle")),Object(r.b)("p",null,"The BM Flow generates the module bundle which will register all your pages, components & methods for you!\nSo feel free to just remove your previous ",Object(r.b)("inlineCode",{parentName:"p"},"module")," (or other) entry altogether! :)"),Object(r.b)("p",null,"For example, if you previously configured yoshi to bundle an entry named ",Object(r.b)("inlineCode",{parentName:"p"},"module")," from ",Object(r.b)("inlineCode",{parentName:"p"},"src/module.ts"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),'import {\n  BusinessManagerModule,\n  IBMModuleParams,\n} from "@wix/business-manager-api";\n\nclass Module extends BusinessManagerModule {\n  constructor(moduleId: string) {\n    super(moduleId);\n\n    this.registerPageComponent(/* ... */);\n    this.registerComponentWithModuleParams(/* ... */);\n  }\n\n  init(moduleParams: IBMModuleParams) {\n    // init stuff\n  }\n}\n')),Object(r.b)("p",null,"You would move the contents of the ",Object(r.b)("inlineCode",{parentName:"p"},"init")," method to a ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"overview#run-code-in-bms-init-phase"}),Object(r.b)("inlineCode",{parentName:"a"},"src/moduleInit.ts")," file")," and remove ",Object(r.b)("inlineCode",{parentName:"p"},"src/module.ts")," entirely."),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Found a use-case we don't cover? ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"#feedback"}),"Let us know!"))),Object(r.b)("hr",null),Object(r.b)("p",null,"If your ",Object(r.b)("inlineCode",{parentName:"p"},"moduleId")," differs from our default one and/or your bundle wasn't previously named ",Object(r.b)("inlineCode",{parentName:"p"},"module.bundle.js"),", you can create a ",Object(r.b)("inlineCode",{parentName:"p"},".module.json")," file to override those:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-json"}),'{\n  "moduleId": "YOUR_MODULE_ID",\n  "moduleBundleName": "my-module" // my-module.bundle.js\n}\n')),Object(r.b)("h3",{id:"page-components"},Object(r.b)("a",Object(o.a)({parentName:"h3"},{href:"overview#pages"}),"Page Components")),Object(r.b)("p",null,"We automatically create & register (inside your module bundle) lazy wrappers of your page components that are in ",Object(r.b)("inlineCode",{parentName:"p"},"src/pages"),"."),Object(r.b)("p",null,"Move your page component's definitions to the ",Object(r.b)("inlineCode",{parentName:"p"},"src/pages")," dir, in a path according to the route this page component will be rendered in."),Object(r.b)("p",null,"For example, a page component in ",Object(r.b)("inlineCode",{parentName:"p"},"src/components/FooPage.tsx")," on route ",Object(r.b)("inlineCode",{parentName:"p"},"/foo/bar")," can be moved to:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-tsx"}),'// src/pages/foo/bar.tsx\nimport { FC } from "react";\nimport { useModuleParams } from "yoshi-flow-bm-runtime";\n\nconst FooPage: FC = () => {\n  const moduleParams = useModuleParams();\n\n  return <div>Foo! {moduleParams.metaSiteId}</div>;\n};\n\nexport default FooPage;\n')),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Note:")," We provide ",Object(r.b)("inlineCode",{parentName:"p"},"moduleParams")," through Context, rather than at the top of your React tree.")),Object(r.b)("p",null,"By default, your page is gonna get a default ",Object(r.b)("inlineCode",{parentName:"p"},"componentId")," & ",Object(r.b)("inlineCode",{parentName:"p"},"componentName"),".\nTo override those, create a neighboring ",Object(r.b)("inlineCode",{parentName:"p"},".json")," file:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-json"}),'// src/pages/foo/bar.json\n{\n  "componentId": "foo-bar-page-component-id",\n  "componentName": "foo-bar-page-component-name"\n}\n')),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Read more about page route logic ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"overview#route"}),"here"))),Object(r.b)("h3",{id:"exported-components"},Object(r.b)("a",Object(o.a)({parentName:"h3"},{href:"overview#exported-components"}),"Exported Components")),Object(r.b)("p",null,"Very similar to page components, but in ",Object(r.b)("inlineCode",{parentName:"p"},"src/exported-components")," and there's no significance (other than the default ",Object(r.b)("inlineCode",{parentName:"p"},"componentId"),") to the relative path inside ",Object(r.b)("inlineCode",{parentName:"p"},"src/exported-components"),":\nMove your existing exported components to ",Object(r.b)("inlineCode",{parentName:"p"},"src/exported-components")),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-tsx"}),'// src/exported-components/modals/FooModal.tsx\nimport { FC } from "react";\n\nconst FooModal: FC = () => {\n  return <div>I should be a modal!</div>;\n};\n\nexport default FooModal;\n')),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Note:")," Exported Components are wrapped with all the same contexts, so ",Object(r.b)("inlineCode",{parentName:"p"},"moduleParams")," are also available using ",Object(r.b)("inlineCode",{parentName:"p"},"useModuleParams"),".")),Object(r.b)("p",null,"If needed, the ",Object(r.b)("inlineCode",{parentName:"p"},"componentId")," can be overridden:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-json"}),'// src/exported-components/modals/FooModal.json\n{\n  "componentId": "foo-modal-component-id"\n}\n')),Object(r.b)("h3",{id:"methods"},Object(r.b)("a",Object(o.a)({parentName:"h3"},{href:"overview#methods"}),"Methods")),Object(r.b)("p",null,"Move existing methods to their own file in ",Object(r.b)("inlineCode",{parentName:"p"},"src/methods"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),"// src/methods/myMethod.ts\n\nexport default () => {\n  //\n};\n")),Object(r.b)("p",null,"Similar to pages & exported-components, the ",Object(r.b)("inlineCode",{parentName:"p"},"methodId")," can also be overridden:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-json"}),'// src/methods/myMethod.json\n{\n  "methodId": "my-method-id"\n}\n')),Object(r.b)("h2",{id:"multiple-gaables"},"Multiple GAables"),Object(r.b)("p",null,"If you are using multiple bundles in your BM ",Object(r.b)("inlineCode",{parentName:"p"},".json")," configuration, so each GAable has its own ",Object(r.b)("inlineCode",{parentName:"p"},"module.bundle.js")," file, you can use ",Object(r.b)("inlineCode",{parentName:"p"},"moduleConfigurationId")," config option to set the ",Object(r.b)("inlineCode",{parentName:"p"},"moduleId")," your configuration is to be taken from during runtime by BM:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-json"}),'// .module.json\n{\n  "moduleId": "MY_MODULE_SETTINGS",\n  "moduleConfigurationId": "MY_MODULE"\n}\n')),Object(r.b)("p",null,"If you are using the less-preferred way of having 1 module bundle, which refers to lazy wrappers that point to separately GAable page/component bundles, you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"legacyBundle")," config option to ease migration into separating GAables into separate module bundles."),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"For BM docs on ",Object(r.b)("inlineCode",{parentName:"p"},"moduleConfigurationId"),", read ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/wix-private/business-manager/blob/master/business-manager-api/docs/business-manager-module.md#setmoduleconfigurationid"}),"here"),"."),Object(r.b)("p",{parentName:"blockquote"},"For more context, read ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/wix/yoshi/issues/2527"}),"here"))),Object(r.b)("h2",{id:"feedback"},"Feedback"),Object(r.b)("p",null,"As the BM Flow is in its early stages, we'd love your feedback, positive & negative!"),Object(r.b)("p",null,"GitHub Issues are more than welcome and as always, we're here to help over @ ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://wix.slack.com/archives/CAL591CDV"}),"#yoshi"),"."))}b.isMDXComponent=!0},259:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return m}));var o=t(0),a=t.n(o);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=a.a.createContext({}),b=function(e){var n=a.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l({},n,{},e)),t},p=function(e){var n=b(e.components);return a.a.createElement(c.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},u=Object(o.forwardRef)((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=b(t),u=o,m=p["".concat(i,".").concat(u)]||p[u]||d[u]||r;return t?a.a.createElement(m,l({ref:n},c,{components:t})):a.a.createElement(m,l({ref:n},c))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=t[c];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);